{{! templates/item-v2.hbs - Updated for new requirements }}
<div class="item-sheet-container">
    <header class="sheet-header">
        <img src="{{#if item.img}}{{item.img}}{{else}}{{defaultIcon}}{{/if}}" data-edit="img" title="{{item.name}}" height="64" width="64"/>
        <h1><input name="name" type="text" value="{{item.name}}" placeholder="Item Name"/></h1>
    </header>

    <section class="sheet-body">
        {{! Weapon-specific fields }}
        {{#if (eq item.type "weapon")}}
            <div class="form-group">
                <label>Weapon Type</label>
                <select name="system.weaponType" data-action="updateWeaponType">
                    {{#each WEAPON_TYPES as |type id|}}
                        <option value="{{id}}" {{#if (eq ../system.weaponType id)}}selected{{/if}}>{{type.label}}</option>
                    {{/each}}
                </select>
            </div>

            {{! Display/Edit weapon properties }}
            {{#if weaponProperties}}
            <div class="form-group">
                <label>Weapon Properties</label>
                <div style="background: var(--bg-tertiary); padding: 10px; border-radius: 5px; margin-top: 5px;">
                    <div class="property-row">
                        <label>Range:</label>
                        <select name="system.customRange">
                        <option value="">Default ({{weaponProperties.range}})</option>
                            {{#each WEAPON_RANGES as |label id|}}
                                {{#if system.customRange}}
                                    <option value="{{id}}" {{#if (eq id system.customRange)}}selected{{/if}}>{{label}}</option>
                                {{else}}
                                    <option value="{{id}}" {{#if (eq id ../weaponProperties.range)}}selected{{/if}}>{{label}}</option>
                                {{/if}}
                            {{/each}}
                        </select>
                    </div>
                    <div class="property-row">
                        <label>Attack Stat:</label>
                        <select name="system.customAttackStat">
                        <option value="">Default ({{weaponProperties.attackStat}})</option>
                            {{#each ATTACK_STATS as |label id|}}
                                {{#if system.customAttackStat}}
                                    <option value="{{id}}" {{#if (eq id system.customAttackStat)}}selected{{/if}}>{{label}}</option>
                                {{else}}
                                    <option value="{{id}}" {{#if (eq id ../weaponProperties.attackStat)}}selected{{/if}}>{{label}}</option>
                                {{/if}}
                            {{/each}}
                        </select>
                    </div>
                    <div class="property-row">
                        <label>Damage Modifier:</label>
                        <input type="number" name="system.customDamageMod" value="{{#if (or (eq system.customDamageMod 0) system.customDamageMod)}}{{system.customDamageMod}}{{/if }}" placeholder="Default: {{weaponProperties.damageMod}}" step="1"/>
                    </div>
                    <div class="property-row">
                        <label>Initiative:</label>
                        <input type="number" name="system.customInitiative" value="{{#if (or (eq system.customInitiative 0) system.customInitiative)}}{{system.customInitiative}}{{/if}}" placeholder="Default: {{weaponProperties.initiative}}" step="1"/>
                    </div>
                </div>
            </div>
            {{/if}}

            {{#if (or (eq system.weaponType "hand") (eq system.weaponType "long"))}}
            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.isTwoHanded" {{checked system.isTwoHanded}}/>
                    Two-Handed
                </label>
                <span>Use weapon with both hands for +1 damage</span>
            </div>
            {{/if}}

            {{#if (eq system.weaponType "throwing")}}
            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.inMelee" {{checked system.inMelee}}/>
                    In Melee Range
                </label>
                <span>Weapon is being used in melee combat (-1 damage penalty)</span>
            </div>
            {{/if}}

            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.equipped" {{checked system.equipped}}/>
                    Equipped
                </label>
                <span>Equip this weapon</span>
            </div>

            <div class="form-group">
                <label>Slot Value</label>
                <input type="number" name="system.slotValue" value="{{system.slotValue}}" min="0" step="1"/>
                <small>How many inventory slots this weapon occupies</small>
            </div>

            {{! Rich text editor for weapon description }}
            <div class="form-group description-group">
                <label>Description</label>
                <prose-mirror name="system.description" button="true" editable="true" toggled="false" value="{{system.description}}">{{{enrichedDescription}}}</prose-mirror>
                <small>Describe this weapon's properties, effects, and special characteristics</small>
            </div>
        {{/if}}

        {{! Armor-specific fields }}
        {{#if (eq item.type "armor")}}
            <div class="form-group">
                <label>Armor Type</label>
                <select name="system.armorType" data-action="updateArmorType">
                    {{#each ARMOR_TYPES as |type id|}}
                        <option value="{{id}}" {{#if (eq ../system.armorType id)}}selected{{/if}}>{{type.label}}</option>
                    {{/each}}
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.equipped" {{checked system.equipped}}/>
                    Equipped
                </label>
                <span>Wear this {{#if (eq system.armorType "shield")}}shield{{else}}armor{{/if}}</span>
            </div>

            <div class="form-group">
                <label>Slot Value</label>
                <input type="number" name="system.slotValue" value="{{system.slotValue}}" min="0" step="1"/>
                <small>How many inventory slots this {{#if (eq system.armorType "shield")}}shield{{else}}armor{{/if}} occupies</small>
            </div>

            {{! Rich text editor for armor description }}
            <div class="form-group description-group">
                <label>Description</label>
                <prose-mirror name="system.description" button="true" editable="true" toggled="false" value="{{system.description}}">{{{enrichedDescription}}}</prose-mirror>
                <small>Describe this armor's properties, effects, and special characteristics</small>
            </div>
        {{/if}}

        {{! Advancement fields }}
        {{#if (eq item.type "advancement")}}
            <div class="form-group">
                <label>Roll Formula</label>
                <input type="text" name="system.rollFormula" value="{{system.rollFormula}}" placeholder="2d6"/>
                <small>Dice formula for this advancement's roll (e.g., 2d6, 1d20, 3d6kh2)</small>
            </div>

            {{! Rich text editor for advancement description }}
            <div class="form-group description-group">
                <label>Description</label>
                <prose-mirror name="system.description" button="true" editable="true" toggled="false" value="{{system.description}}">{{{enrichedDescription}}}</prose-mirror>
                <small>Describe this advancement's effects, benefits, and special characteristics</small>
            </div>
        {{/if}}

        {{! Consequence-specific fields }}
        {{#if (eq item.type "consequence")}}
            <div class="form-group">
                <label>Consequence Type</label>
                <select name="system.consequenceType" data-action="updateConsequenceType">
                    {{#each CONSEQUENCE_TYPES as |type id|}}
                        <option value="{{id}}" {{#if (eq ../system.consequenceType id)}}selected{{/if}}>{{type.label}}</option>
                    {{/each}}
                </select>
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center;">
                    <input type="checkbox" name="system.hasUses" {{checked system.hasUses}} style="margin-right: 8px;"/>
                    <span>Track Number of Uses</span>
                </label>
                <small>Enable this to track how many times this consequence can be used</small>
            </div>

            {{#if system.hasUses}}
            <div class="form-group uses-group">
                <label>Number of Uses</label>
                <div class="uses-input">
                    <input type="number" name="system.uses.current" value="{{system.uses.current}}" min="0" class="uses-current" placeholder="0"/>
                    <span class="uses-separator">/</span>
                    <input type="number" name="system.uses.max" value="{{system.uses.max}}" min="0" class="uses-max" placeholder="0"/>
                </div>
                <small>Current / Maximum uses for this consequence</small>
            </div>
            {{/if}}

            {{! Rich text editor for consequence description }}
            <div class="form-group description-group">
                <label>Description</label>
                <prose-mirror name="system.description" button="true" editable="true" toggled="false" value="{{system.description}}">{{{enrichedDescription}}}</prose-mirror>
                <small>Describe this consequence's effects and impact on the character</small>
            </div>
        {{/if}}


        {{! Loot-specific fields - simplified }}
        {{#if (eq item.type "loot")}}
            <div class="form-group">
                <label>Affluence</label>
                <input type="number" name="system.affluence" value="{{system.affluence}}" min="0" step="1"/>
                <small>Affluence value of this item</small>
            </div>

            <div class="form-group">
                <label>Slot Value</label>
                <input type="number" name="system.slotValue" value="{{system.slotValue}}" min="0" step="1"/>
                <small>How many inventory slots this item occupies</small>
            </div>
            
            {{! Rich text editor for loot description }}
            <div class="form-group description-group">
                <label>Description</label>
                <prose-mirror name="system.description" button="true" editable="true" toggled="false" value="{{system.description}}">{{{enrichedDescription}}}</prose-mirror>
                <small>Describe this loot's properties, effects, and special characteristics</small>
            </div>


        {{/if}}
    </section>
</div>

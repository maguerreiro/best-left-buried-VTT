{{! templates/item-v2.hbs - Updated for new requirements }}
<div class="item-sheet-container">
    <header class="sheet-header">
        <img src="{{#if item.img}}{{item.img}}{{else}}{{defaultIcon}}{{/if}}" data-edit="img" title="{{item.name}}" height="64" width="64"/>
        <h1><input name="name" type="text" value="{{item.name}}" placeholder="Item Name"/></h1>
    </header>

    <section class="sheet-body">
        {{! Weapon-specific fields }}
        {{#if (eq item.type "weapon")}}
            <div class="form-group">
                <label>Weapon Type</label>
                <select name="system.weaponType" data-action="updateWeaponType">
                    {{#each WEAPON_TYPES as |type id|}}
                        <option value="{{id}}" {{#if (eq ../system.weaponType id)}}selected{{/if}}>{{type.label}}</option>
                    {{/each}}
                </select>
            </div>

            {{! Display weapon properties }}
            {{#if weaponProperties}}
            <div class="form-group">
                <label>Weapon Properties</label>
                <div style="background: var(--bg-tertiary); padding: 10px; border-radius: 5px; margin-top: 5px;">
                    <p><strong>Range:</strong> {{weaponProperties.range}}</p>
                    <p><strong>Attack Stat:</strong> {{weaponProperties.attackStat}}</p>
                    <p><strong>Damage Modifier:</strong> {{weaponProperties.damageMod}}</p>
                    <p><strong>Initiative:</strong> {{weaponProperties.initiative}}</p>
                </div>
            </div>
            {{/if}}

            {{#if (or (eq system.weaponType "hand") (eq system.weaponType "long"))}}
            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.isTwoHanded" {{checked system.isTwoHanded}}/>
                    Two-Handed
                </label>
                <span>Use weapon with both hands for +1 damage</span>
            </div>
            {{/if}}

            {{#if (eq system.weaponType "throwing")}}
            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.inMelee" {{checked system.inMelee}}/>
                    In Melee Range
                </label>
                <span>Weapon is being used in melee combat (-1 damage penalty)</span>
            </div>
            {{/if}}

            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.equipped" {{checked system.equipped}}/>
                    Equipped
                </label>
                <span>Equip this weapon</span>
            </div>

            <div class="form-group">
                <label>Slot Value</label>
                <input type="number" name="system.slotValue" value="{{system.slotValue}}" min="0" step="1"/>
                <small>How many inventory slots this weapon occupies</small>
            </div>

            {{! Description field for weapons }}
            <div class="form-group description-group">
                <label>Description</label>
                <textarea name="system.description" rows="3" placeholder="Enter weapon description...">{{system.description}}</textarea>
                <small>Describe this weapon's properties, effects, and special characteristics</small>
            </div>
        {{/if}}

        {{! Armor-specific fields }}
        {{#if (eq item.type "armor")}}
            <div class="form-group">
                <label>Armor Type</label>
                <select name="system.armorType" data-action="updateArmorType">
                    {{#each ARMOR_TYPES as |type id|}}
                        <option value="{{id}}" {{#if (eq ../system.armorType id)}}selected{{/if}}>{{type.label}}</option>
                    {{/each}}
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.equipped" {{checked system.equipped}}/>
                    Equipped
                </label>
                <span>Wear this {{#if (eq system.armorType "shield")}}shield{{else}}armor{{/if}}</span>
            </div>

            <div class="form-group">
                <label>Slot Value</label>
                <input type="number" name="system.slotValue" value="{{system.slotValue}}" min="0" step="1"/>
                <small>How many inventory slots this {{#if (eq system.armorType "shield")}}shield{{else}}armor{{/if}} occupies</small>
            </div>

            {{! Description field for armor }}
            <div class="form-group description-group">
                <label>Description</label>
                <textarea name="system.description" rows="3" placeholder="Enter armor description...">{{system.description}}</textarea>
                <small>Describe this armor's properties, effects, and special characteristics</small>
            </div>
        {{/if}}

        {{! Advancement-specific fields - simplified }}
        {{#if (eq item.type "advancement")}}
            <div class="form-group">
                <label>Roll Formula</label>
                <input type="text" name="system.rollFormula" value="{{system.rollFormula}}" placeholder="2d6"/>
                <small>Dice formula for this advancement's roll (e.g., 2d6, 1d20, 3d6kh2)</small>
            </div>

            <div class="form-group">
                <button type="button" data-action="rollAdvancement" class="roll-button" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                    <i class="fas fa-dice-d20"></i> Roll {{item.name}}
                </button>
            </div>

            {{! Only description field for advancements }}
            <div class="form-group description-group">
                <label>Description</label>
                <textarea name="system.description" rows="3" placeholder="Enter advancement description...">{{system.description}}</textarea>
                <small>Describe this advancement's effects, benefits, and special characteristics</small>
            </div>
        {{/if}}

        {{! Consequence-specific fields }}
        {{#if (eq item.type "consequence")}}
            <div class="form-group">
                <label>Consequence Type</label>
                <select name="system.consequenceType" data-action="updateConsequenceType">
                    {{#each CONSEQUENCE_TYPES as |type id|}}
                        <option value="{{id}}" {{#if (eq ../system.consequenceType id)}}selected{{/if}}>{{type.label}}</option>
                    {{/each}}
                </select>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" name="system.active" {{checked system.active}}/>
                    Active
                </label>
                <span>This consequence is currently affecting the character</span>
            </div>

            {{! Description field for consequences }}
            <div class="form-group description-group">
                <label>Description</label>
                <textarea name="system.description" rows="3" placeholder="Enter consequence description...">{{system.description}}</textarea>
                <small>Describe this consequence's effects and impact on the character</small>
            </div>
        {{/if}}

        {{! Loot-specific fields - simplified }}
        {{#if (eq item.type "loot")}}
            <div class="form-group">
                <label>Affluence</label>
                <input type="number" name="system.affluence" value="{{system.affluence}}" min="0" step="1"/>
                <small>Affluence value of this item</small>
            </div>

            <div class="form-group">
                <label>Slot Value</label>
                <input type="number" name="system.slotValue" value="{{system.slotValue}}" min="0" step="1"/>
                <small>How many inventory slots this item occupies</small>
            </div>
        {{/if}}
    </section>
</div>